{{ define "main" }}
    {{ .Content }}

    <div class="planner"></div>
    <script>
        const TOTAL_GROUPS = 10
        const CHARACTERS_PER_GROUP = 5
        const PLANNER = document.querySelector('.planner')
        const ROLES = ["Melee DPS", "Ranged DPS", "Mixed DPS", "Tank", "Healer"].sort()
        const WEAPON_TYPES = ["Sword & Shield", 'Bow', 'Great Axe', 'War Hammer', 'Musket', 'Spear', 'Hatchet', 'Rapier', 'Life Staff', 'Fire Staff', 'Ice Gauntlet', 'Void Gauntlet'].sort()

        class Character {
            constructor(role, name, primaryWeapon, secondaryWeapon) {
                this.role = ROLES.find(r => r === role)
                this.name = name
                this.primaryWeapon = WEAPON_TYPES.find(w => w === primaryWeapon)
                this.secondaryWeapon = WEAPON_TYPES.find(w => w === secondaryWeapon)
            }
        }

        function getRandomRole() {
            return ROLES[Math.floor(Math.random() * ROLES.length)]
        }

        function getRandomIndex(array) {
            return Math.floor(Math.random() * array.length)
        }

        function getRandomWeaponType(role, primaryWeapon) {
            const tankWeapons = ['Sword & Shield']
            const meleeWeapons = ['Great Axe', 'War Hammer', 'Spear', 'Hatchet', 'Rapier']
            const rangedWeapons = ['Bow', 'Musket', 'Life Staff', 'Fire Staff', 'Ice Gauntlet', 'Void Gauntlet', 'Hatchet']
            const healerWeapons = ['Life Staff']
            if (primaryWeapon) {
                switch (role) {
                    case 'Mixed DPS':
                        if (meleeWeapons.includes(primaryWeapon)) {
                            return rangedWeapons[getRandomIndex(rangedWeapons)]
                        } else {
                            return meleeWeapons[getRandomIndex(meleeWeapons)]
                        }
                    case 'Tank':
                        return meleeWeapons[getRandomIndex(meleeWeapons)]
                    case 'Healer':
                        return 'Void Gauntlet'
                }
            }

            switch (role) {
                case 'Tank':
                    return tankWeapons[getRandomIndex(tankWeapons)]
                case 'Melee DPS':
                    return meleeWeapons[getRandomIndex(meleeWeapons)]
                case 'Ranged DPS':
                    return rangedWeapons[getRandomIndex(rangedWeapons)]
                case 'Mixed DPS':
                    return meleeWeapons[getRandomIndex(meleeWeapons)]
                case 'Healer':
                    return healerWeapons[getRandomIndex(healerWeapons)]
            }
        }

        for (let i = 0; i < TOTAL_GROUPS; i++) {
            const groupHeader = document.createElement('h2')
            groupHeader.innerText = 'Group ' + i.toString()

            for (let c = 0; c < CHARACTERS_PER_GROUP; c++) {
                const role = getRandomRole()
                const primaryWeapon = getRandomWeaponType(role)
                const secondaryWeapon = getRandomWeaponType(role, primaryWeapon)
                const character = new Character(role, 'Example Character', primaryWeapon, secondaryWeapon)
                console.log(character)
            }

            const groupContainer = document.createElement('div')
            groupContainer.appendChild(groupHeader)
            PLANNER.appendChild(groupContainer)
        }
    </script>
{{ end }}