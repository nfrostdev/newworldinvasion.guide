{{ define "main" }}
    {{ .Content }}

    <div class="planner"></div>
    <script>
        const TOTAL_GROUPS = 10
        const CHARACTERS_PER_GROUP = 5
        const PLANNER = document.querySelector('.planner')
        const ROLES = ["Melee DPS", "Ranged DPS", "Tank", "Healer"].sort()
        const WEAPON_TYPES = ["Sword & Shield", 'Bow', 'Great Axe', 'War Hammer', 'Musket', 'Spear', 'Hatchet', 'Rapier', 'Life Staff', 'Fire Staff', 'Ice Gauntlet', 'Void Gauntlet'].sort()
        const TANK_WEAPONS = ['Sword & Shield']
        const MELEE_WEAPONS = ['Great Axe', 'War Hammer', 'Spear', 'Hatchet', 'Rapier'].sort()
        const RANGED_WEAPONS = ['Bow', 'Musket', 'Fire Staff', 'Ice Gauntlet', 'Void Gauntlet', 'Hatchet'].sort()
        const HEALER_WEAPONS = ['Life Staff']

        class Character {
            constructor(primaryWeapon, secondaryWeapon) {
                if (TANK_WEAPONS.includes(primaryWeapon) || TANK_WEAPONS.includes(secondaryWeapon)) {
                    this.role = 'Tank'
                } else if (HEALER_WEAPONS.includes(primaryWeapon) || HEALER_WEAPONS.includes(secondaryWeapon)) {
                    this.role = 'Healer'
                } else if (RANGED_WEAPONS.includes(primaryWeapon) || RANGED_WEAPONS.includes(secondaryWeapon)) {
                    this.role = 'Ranged DPS'
                } else {
                    this.role = 'Melee DPS'
                }
                this.name = 'Example ' + this.role
                this.primaryWeapon = WEAPON_TYPES.find(w => w === primaryWeapon)
                this.secondaryWeapon = WEAPON_TYPES.find(w => w === secondaryWeapon)
            }
        }

        function init() {
            localStorage.getItem('')
        }

        function getRandomRole() {
            return ROLES[Math.floor(Math.random() * ROLES.length)]
        }

        function getRandomIndex(array) {
            return Math.floor(Math.random() * array.length)
        }

        function getRandomWeaponType(primaryWeapon) {
            const filteredWeapons = WEAPON_TYPES.filter(wt => wt !== primaryWeapon)
            return filteredWeapons[getRandomIndex(filteredWeapons)]
        }

        for (let i = 0; i < TOTAL_GROUPS; i++) {
            const groupContainer = document.createElement('div')
            groupContainer.classList.add('planner__group')
            // Append the group container.
            PLANNER.appendChild(groupContainer)

            const groupHeader = document.createElement('h2')
            groupHeader.innerText = 'Group ' + (i + 1).toString()
            groupHeader.classList.add('planner__group__header')
            // Append the group header.
            groupContainer.appendChild(groupHeader)

            const groupCharacterContainer = document.createElement('div')
            groupCharacterContainer.classList.add('planner__group__characters')
            // Append the character container.
            groupContainer.appendChild(groupCharacterContainer)

            for (let c = 0; c < CHARACTERS_PER_GROUP; c++) {
                const primaryWeapon = getRandomWeaponType()
                const secondaryWeapon = getRandomWeaponType(primaryWeapon)
                const character = new Character(primaryWeapon, secondaryWeapon)

                const characterContainer = document.createElement('div')
                characterContainer.classList.add('planner__group__character')

                const characterRole = document.createElement('img')
                characterRole.classList.add('planner__group__character__role')

                switch (character.role) {
                    case 'Tank':
                        characterContainer.classList.add('planner__group__character--tank')
                        characterRole.src = 'https://cdn.nwdb.info/db/images/live/v2/icons/abilities/swordability6.png'
                        characterRole.classList.add('planner__group__character__role--tank')
                        break
                    case 'Melee DPS':
                        characterContainer.classList.add('planner__group__character--melee')
                        characterRole.src = 'https://cdn.nwdb.info/db/images/live/v2/icons/abilities/hatchetability4.png'
                        characterRole.classList.add('planner__group__character__role--melee')
                        break
                    case 'Healer':
                        characterContainer.classList.add('planner__group__character--healer')
                        characterRole.src = 'https://cdn.nwdb.info/db/images/live/v2/icons/abilities/lifestaffability3.png'
                        characterRole.classList.add('planner__group__character__role--healer')
                        break
                    default:
                        characterContainer.classList.add('planner__group__character--ranged')
                        characterRole.src = 'https://cdn.nwdb.info/db/images/live/v2/icons/abilities/bowability2.png'
                        characterRole.alt = 'Ranged DPS'
                        characterRole.classList.add('planner__group__character__role--ranged')
                }
                characterRole.alt = character.role
                characterRole.title = character.role

                const characterNameRole = document.createElement('div')
                characterNameRole.classList.add('planner__group__character__name')

                const characterName = document.createElement('div')
                characterName.innerText = character.name.toString()

                const characterWeapons = document.createElement('div')
                characterWeapons.classList.add('planner__group__character__weapons')

                const characterPrimaryWeapon = document.createElement('select')
                characterPrimaryWeapon.innerText = character.primaryWeapon.toString()
                characterPrimaryWeapon.classList.add('planner__group__character__weapon')

                const characterSecondaryWeapon = document.createElement('select')
                characterSecondaryWeapon.innerText = character.secondaryWeapon.toString()
                characterSecondaryWeapon.classList.add('planner__group__character__weapon')

                WEAPON_TYPES.forEach(wt => {
                    const primaryEl = document.createElement('option')
                    primaryEl.value = wt
                    primaryEl.innerText = wt
                    characterPrimaryWeapon.appendChild(primaryEl)

                    if (wt === character.primaryWeapon) {
                        primaryEl.selected = true
                    }

                    const secondaryEl = document.createElement('option')
                    secondaryEl.value = wt
                    secondaryEl.innerText = wt
                    characterSecondaryWeapon.appendChild(secondaryEl)

                    if (wt === character.secondaryWeapon) {
                        secondaryEl.selected = true
                    }
                })

                // Append character information to the character container.
                characterContainer.appendChild(characterNameRole)
                characterNameRole.appendChild(characterRole)
                characterNameRole.appendChild(characterName)
                characterContainer.appendChild(characterWeapons)
                characterWeapons.appendChild(characterPrimaryWeapon)
                characterWeapons.appendChild(characterSecondaryWeapon)

                // Append this character to the character container.
                groupCharacterContainer.appendChild(characterContainer)
            }
        }
    </script>
{{ end }}